---

- debug:
    msg: "imported RedHat/generic/disable-ksm.yml"

- name: Create file /etc/init.d/boot.local if it does not exist
  file:
    path: /etc/init.d/boot.local
    state: touch
    mode: 0755

- name: Get info about file /etc/init.d/boot.local
  stat:
    path: /etc/init.d/boot.local
  register: stat_boot_local

- name: Disable KSM at boot time
  lineinfile:
    dest: /etc/init.d/boot.local
    line: "echo 0 > /sys/kernel/mm/ksm/run"
  when: stat_boot_local.stat.exists

- name: Disable KSM on the running system
  shell: echo 0 > /sys/kernel/mm/ksm/run
  register: command_result
- debug:
    var: command_result.stdout_lines, command_result.stderr_lines

- name: Get status of KSM
  command: cat /sys/kernel/mm/ksm/run
  register: command_result
  ignore_errors: true
  changed_when: false
- debug:
    var: command_result.stdout_lines, command_result.stderr_lines

...
